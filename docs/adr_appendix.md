# ADR Appendix

| ADR Title                                               | Round | Key Words                | Quick Summary                                                      |
|--------------------------------------------------------|-------|--------------------------|--------------------------------------------------------------------|
| ADR-0001: Dart Version Compatibility (3.8.1 vs 3.9.1)  | 2     | dart, compatibility      | Sets minimum Dart SDK to 3.8.1 for broader compatibility; no 3.9.1+ features used. |
| ADR-0002: Strongly-Typed Tool Interfaces and Backward Compatibility | 2 | typing, interfaces, ToolInput, ToolOutput, registry | Introduces opt-in strongly-typed tool interfaces with abstract base classes and registry, maintaining backward compatibility. |
| ADR-0003: Per-Step Audit System and Configurable Retry Logic | 2 | audits, StepConfig, retry, issue tracking, weighted scoring | Adds per-step audit configuration, custom retry logic, and round-based issue tracking for flexible validation and debugging. |
| ADR-0001: OpenAI Service Extraction and Dependency Injection | 3 | OpenAI, service, dependency injection, ToolFlow, request typing | Extracts OpenAI API logic into a dedicated service with dependency injection for testability, type safety, and maintainability. |
| ADR-0002: Issue Forwarding and Step Configuration Enhancement | 3 | issue forwarding, StepConfig, ToolCallStep, output sanitization, tool name keying | Enables selective issue/output forwarding, direct StepConfig integration, and flexible multi-step input composition for efficient, context-aware orchestration. |
| ADR-0003: Round 3 Implementation Summary and Architectural Evolution | 3 | architecture, service injection, StepConfig, tool name access, migration | Summarizes round 3 refactor: service injection, direct step config, selective forwarding, tool name-based access, and migration path for maintainability and extensibility. |
| ADR-0001: Consolidate StepInput and ToolInput Classes | 4     | ToolInput, StepInput, Issue, copyWith, sanitization | Combines StepInput and ToolInput into a single concrete class, improves type safety, filters previous issues, and adds copyWith for cleaner result modification. |
| ADR-0002: Implement Selective Previous Issues Inclusion | 4     | selective issues, includeOutputsFrom, step input, optimization | Only includes previous issues from steps specified in includeOutputsFrom, reducing noise and improving tool input relevance. |
| ADR-0003: Improve Output Sanitization and ToolResult Modification Patterns | 4     | output sanitization, ToolResult, copyWith, data processing | Moves output sanitization before typedOutput creation and introduces copyWith for ToolResult, ensuring clean, maintainable, and consistent data handling. |
| ADR-0001: Consolidate Interfaces and Use Structured Data | 5     | ToolInput, StepInput, ToolResult, type safety, fail fast, named parameters | Removes StepInput, uses ToolInput everywhere, passes ToolResult for previous context, maintains structured data, and fails fast on typed output errors. |
| ADR-0001: Dynamic Input Builder Pattern | 6     | inputBuilder, dynamic execution, ToolCallStep, runtime flexibility | Replaces static params with dynamic inputBuilder functions that execute at runtime with actual previous results for flexible input construction. |
| ADR-0002: Mandatory Typed Interfaces for ToolResult | 6     | ToolResult, TypedInput, TypedOutput, type safety, interface consolidation | Makes ToolInput and ToolOutput required in ToolResult, eliminating Map-based fallbacks and ensuring type safety throughout the system. |
| ADR-0003: Retain Input Sanitizer with Enhanced Role | 6     | inputSanitizer, inputBuilder, state management, framework integration | Keeps inputSanitizer as a post-inputBuilder transformation layer for framework-level concerns while inputBuilder handles user-level input construction. |
| ADR-0001: Generic AuditFunction and ToolResult for Type Safety | 7 | generics, type-safety, audit-function, tool-result, typescript-like-patterns | Implements generic types for AuditFunction and ToolResult to provide compile-time type safety and eliminate unsafe casting. |
| ADR-0002: OpenAI Tool Definition Schema Fix - Output-Based Instead of Input-Based | 7 | openai, schema, tool-definition, output-schema, api-integration | Fixes OpenAI tool definition to use output schema instead of input schema, with StepConfig.outputSchema for proper API alignment. |
| ADR-MISC-001: Retain InputSanitizer for Framework-Level Input Transformation | 8 | inputSanitizer, inputBuilder, framework, security, state | Retains inputSanitizer as a post-inputBuilder layer for framework-level concerns, context injection, and security filtering. |
| ADR-MISC-002: Remove PreviousResults from ToolInput in Favor of InputBuilder | MISC  | ToolInput, previousResults, inputBuilder, API, workflow | Removes previousResults from ToolInput, relying on inputBuilder for workflow context and explicit input construction. |
| ADR-0001: Refactor ToolFlow Orchestration for Per-Step Generic Typing | 8 | toolflow, generics, audit, type-safety, ToolResult | Refactors ToolFlow orchestration to support per-step generic typing, enabling type-safe audit execution and robust, extensible result storage. |
| ADR-0002: TypedToolResult Wrapper Implementation for Per-Step Generic Typing | 8 | TypedToolResult, wrapper, runtime type checking, audit execution, backward compatibility | Implements TypedToolResult wrapper pattern with enhanced ToolOutputRegistry to achieve per-step generic typing while maintaining compatibility and working within Dart's type system constraints. |
| ADR-0001: Structured OutputSchema Implementation and Code Cleanup | 9 | OutputSchema, PropertyEntry, schema derivation, code cleanup, type safety | Implements structured OutputSchema classes to replace loose maps, removes unused code, enables automatic schema derivation from ToolOutput, while maintaining backward compatibility. |
| ADR-0004: PropertyEntry.items should be PropertyType, not PropertyEntry | 9 | PropertyEntry, PropertyType, array, schema | Changes PropertyEntry.items to PropertyType to specify array item type, matching JSON Schema, improving clarity, and simplifying consumer logic. |
| ADR-0001: Example Consolidation and Code Cleanup | 10    | examples, cleanup, consolidation | Consolidates duplicated example files into a single comprehensive file, removes unreferenced code, and eliminates maintenance burden from duplicate workflows. |
| ADR-0001: Non-Optional ToolOutputRegistry and Round Parameter Requirements | 11 | ToolOutputRegistry, ToolOutput, round-parameter, TypedToolResult, breaking-changes | Makes ToolOutputRegistry methods non-optional and adds required round parameter to ToolOutput for improved type safety and debugging support. |
| ADR-0001: Step Definition Pattern for Type-Safe Tool Configuration | 12 | step-definition, type-safety, tool-configuration, automation, StepDefinition | Implements centralized step definition pattern to eliminate error-prone string usage and automate typed output registration. |
| ADR-0001: Replace includeOutputsFrom with includeResultsInToolcall and Severity Filtering | 13 | includeResultsInToolcall, severity-filtering, system-messages, stepconfig, issue-context | Replaces includeOutputsFrom with includeResultsInToolcall to include both tool outputs and filtered issues in OpenAI system messages, providing context about previous problems while preventing token bloat. |
| ADR-0001: Professional Color Theme Generation Workflow Enhancement | 15 | workflow, color-generation, expert-guidance, maxRetries, comprehensive-output | Implements 3-step professional color workflow (seed→system→suite) with expert personas, maxRetries=3, and comprehensive 30-color output for production use. |